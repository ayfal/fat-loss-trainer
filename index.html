<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="title">Fat Loss Trainer</title>
    <style> * {font-size: xx-large; text-align: center;}</style>
  </head>
  <body>
	<div id="msg">
    <p>
      The body gets his energy from food, and stores most of it as fat for later use.<br>
      Exercise uses energy, and builds muscles which use even more energy all day long.<br>
      This site will help you lose fat by doing a simple and short exercise, and slightly changing your nutrition.
    </p>
    <p>
      In order to adjust the workout length, there are two things we need to know:<br>
      1) The monthly change in your weight (because weight fluctuates):<br>
      Last month your weight was <span id="previousWeight"></span><br>
	  <label for="weight">How much do you weigh today?</label>
	  <input type="number" step="0.1" id="weight" required><br>
	  2) Do you look fat? (Don't judge by your weight, because of muscle mass)
	  <button id="yes" onclick="calculateLength(true)">Yes</button><button id="no" onclick="calculateLength(false)">No</button>
    </p>
  </div>
	<button id="stbt" style="display:none" onclick="start()">Start</button>
	<p id="bar" style="width:0%"></p>
	<script>
	var wltd,d,pw,st,rt,t,e;
	
	window.onload=function(){
		wltd/*weight loss trainer data*/ = (localStorage.wlt!==undefined) ? JSON.parse(localStorage.wlt) : {} ;
		d=new Date();
		pw/*Previous Weight*/=wltd[d.getDate()];
		document.getElementById("previousWeight").innerHTML=pw;
	}
	
  function calculateLength(isFat) {
    f=isFat;
    w=document.getElementById("weight").value;
    if (w!==""){
      if (wltd.wl/*Workout Length*/==undefined) {wltd.wl=0;}
      if (pw==undefined){pw=0;}
      dsps/*Days Since Previous Session*/=Math.round((Date.now()-wltd.ps/*Previous Session*/)/(1000*60*60*24));
      if (dsps>1){wltd.wl-=(dsps-1);}
      if (wltd.wl<0){wltd.wl=0;}
      if (f && w>=pw) {wltd.wl++;} else if (!f && pw>=w) {wltd.wl--;}			
      wltd[d.getDate().toString()]=w;
      if (wltd.wl>0) {
        document.getElementById("msg").innerHTML="Today's exercise is to strain all your muscles at once for "+wltd.wl+" seconds.<br>Using fat for energy takes oxygen (among other things), and muscles need rest to work longer, so rest while you inhale, and strain while you exhale. Both inhaling and exhaling are done through the nose and lasts 3 seconds each.";
		document.getElementById("stbt").style.display="inline";
      } else {
        document.getElementById("msg").innerHTML="You don't need to exercise today.";
      }	
    }
  }
			
function start() {
	document.getElementById("stbt").style.display="none";
	rt/*Remaining Time*/=Number(wltd.wl);
	inhale();
	t=setInterval(timer,10);	
}

function inhale(){	
	document.getElementById("msg").innerHTML="Inhale & relax";
	document.getElementById("bar").style.background="#4CAF50";
	st/*Start Time*/=Date.now();
	setTimeout(exhale,3000);
}

function exhale(){
	document.getElementById("msg").innerHTML="Exhale & strain";
	document.getElementById("bar").style.background="#FF6347";
	st=Date.now();
	setTimeout(function(){
		rt-=3;
		if (rt>0) {
			inhale();
		} else{			
			clearInterval(t);
			document.getElementById("msg").innerHTML="Well done, come back tomorrow.<p>Using fat for energy also requires water, so whenever your urine is yellow drink water, and your apetite will subside.<br>Apart from that you can eat as usual, though unnecessary food will just have to get out by more exercise.</p>"; 
			document.getElementById("bar").style.display="none";
			wltd.ps=st;
			localStorage.wlt=JSON.stringify(wltd);
		}
	},Math.min(rt,3)*1000);
}

function timer(){	
	if (document.getElementById("msg").innerHTML.includes("Inhale")) {
		document.getElementById("bar").style.width=(Date.now()-st)/30+"%";
		document.getElementById("bar").innerHTML=3-Math.trunc((Date.now()-st)/1000);		
	} else {		
		document.getElementById("bar").style.width=100-((Date.now()-st)/Math.min(30,rt*10))+"%";
		document.getElementById("bar").innerHTML=rt-Math.trunc((Date.now()-st)/1000);
	}
}
	</script>
	  <script data-goatcounter="https://ayfalgh.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
  </body>
</html>
